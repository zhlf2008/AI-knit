# éšæœºç§å­åŠŸèƒ½ - æœ€ç»ˆä¼˜åŒ–ï¼ˆå‚è€ƒ aardioï¼‰

## å‚è€ƒå®ç°åˆ†æ

å‚è€ƒ `C:\Users\KH\Downloads\aardio\example\AI\image\hf-z-image.aardio` çš„å…³é”®å®ç°ï¼š

### aardio çš„éšæœºç§å­é€»è¾‘

```aardio
// ç¬¬ 58 è¡Œï¼šä» UI è·å–ç§å­
var seed = tonumber(winform.editSeed.text) || 42;

// ç¬¬ 61 è¡Œï¼šè·å–éšæœºç§å­å¤é€‰æ¡†çŠ¶æ€ï¼ˆå¸ƒå°”å€¼ï¼‰
var randomSeed = winform.chkRandomSeed.checked;

// ç¬¬ 89-96 è¡Œï¼šä¼ é€’å‚æ•°åˆ° API
var result, err = gradio.xcall.generate({
    data = [
        prompt,                  // æç¤ºè¯
        resolution,              // åˆ†è¾¨ç‡
        seed,                    // ç§å­ï¼ˆå›ºå®šå€¼ï¼‰
        steps,                   // æ­¥æ•°
        timeShift,               // æ—¶é—´åç§»
        randomSeed,              // å¸ƒå°”å€¼ï¼šæ˜¯å¦ä½¿ç”¨éšæœºç§å­
        []                       // Gallery
    ]
});

// ç¬¬ 109 è¡Œï¼šè·å– API è¿”å›çš„å®é™…ç§å­
var seedUsed = result[2]; 

// ç¬¬ 125-126 è¡Œï¼šå¦‚æœæ˜¯éšæœºç§å­ï¼Œæ›´æ–° UI
if(randomSeed) winform.editSeed.text = tostring(seedUsed);
```

### å…³é”®å‘ç°

1. **`randomSeed` æ˜¯å¸ƒå°”å€¼**ï¼Œä¸æ˜¯éšæœºæ•°å­—
2. **API å†…éƒ¨å¤„ç†éšæœºæ€§**ï¼šå½“ `randomSeed=true` æ—¶ï¼ŒAPI ä¼šå¿½ç•¥ seed å‚æ•°ï¼Œå†…éƒ¨ç”Ÿæˆéšæœºç§å­
3. **API è¿”å›å®é™…ä½¿ç”¨çš„ç§å­**ï¼š`result[2]` æ˜¯ API å®é™…ä½¿ç”¨çš„ç§å­å€¼
4. **åªåœ¨éšæœºæ¨¡å¼æ›´æ–° UI**ï¼šå½“ `randomSeed=true` æ—¶ï¼Œæ‰ç”¨ `seedUsed` æ›´æ–° UI

## æœ€ç»ˆå®ç°æ–¹æ¡ˆ

### æ ¸å¿ƒæ”¹è¿›

1. **é€‰ä¸­éšæœºç§å­æ—¶**ï¼šç«‹å³æ˜¾ç¤ºéšæœºç§å­æ•°å­—ï¼ˆuseEffectï¼‰
2. **ç”Ÿæˆå®Œæˆå**ï¼šæ›´æ–° UI ä¸º API è¿”å›çš„å®é™…ç§å­
3. **å–æ¶ˆéšæœºç§å­æ—¶**ï¼šä¿ç•™ä¸Šæ¬¡çš„ç§å­å€¼ï¼ˆuseEffect ä¸è§¦å‘ï¼‰

### å®ç°ç»†èŠ‚

#### 1. useEffect ç›‘å¬éšæœºæ¨¡å¼ï¼ˆé€‰ä¸­æ—¶ç«‹å³ç”Ÿæˆï¼‰

```typescript
// åœ¨ isRandomSeed å˜ä¸º true æ—¶ï¼Œç«‹å³ç”Ÿæˆå¹¶æ˜¾ç¤ºéšæœºç§å­
useEffect(() => {
  if (isRandomSeed) {
    const randomSeed = Math.floor(Math.random() * 1000000);
    setSeedInput(randomSeed.toString());
  }
  // å…³é”®ï¼šå½“ isRandomSeed å˜ä¸º false æ—¶ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼ˆä¿ç•™å½“å‰å€¼ï¼‰
}, [isRandomSeed]);
```

#### 2. ç®€åŒ–ç”Ÿæˆé€»è¾‘

**ä¿®å¤å‰**ï¼š
```typescript
const usedSeed = isRandomSeed ? Math.floor(Math.random() * 1000000) : parseInt(seedInput) || 42;
```

**ä¿®å¤å**ï¼š
```typescript
const usedSeed = parseInt(seedInput) || 42;
```

**åŸå› **ï¼š
- éšæœºç§å­ç”± useEffect åœ¨ UI å±‚é¢ç”Ÿæˆ
- ç”Ÿæˆå‡½æ•°ç›´æ¥ä½¿ç”¨ seedInput çš„å€¼ï¼ˆæ— è®ºæ˜¯å¦éšæœºï¼‰
- ä¸éœ€è¦åœ¨ç”Ÿæˆæ—¶åˆ¤æ–­æ˜¯å¦éšæœº

#### 3. ç”Ÿæˆåæ›´æ–° UIï¼ˆä½¿ç”¨ API è¿”å›çš„ç§å­ï¼‰

```typescript
const result = await generateImage(prompt, resolution, usedSeed, config, controller.signal);

// ä½¿ç”¨ API è¿”å›çš„ç§å­ï¼Œå¦‚æœæ²¡æœ‰åˆ™å›é€€åˆ° usedSeed
const actualSeed = result.seed || usedSeed;

setGenerationState({
  isGenerating: false,
  progress: 100,
  imageUrl: result.imageUrl,
  seed: actualSeed
});

// æ›´æ–° UI ä¸ºå®é™…ä½¿ç”¨çš„ç§å­ï¼ˆéµå¾ª aardio æ¨¡å¼ï¼‰
setSeedInput(actualSeed.toString());
```

#### 4. æœåŠ¡å±‚è¿”å›ç§å­å€¼

```typescript
// services/generationService.ts

// ä¿®æ”¹è¿”å›ç±»å‹ï¼ŒåŒ…å«ç§å­ä¿¡æ¯
const generateWithZImage = async (
  ...
): Promise<{ imageUrl: string; seed: number | null }> => {
  // ...

  // è¿”å›å›¾åƒå’Œç§å­
  return {
    imageUrl: taskData.output_images[0],
    seed: null // ModelScope API ç›®å‰ä¸è¿”å›ç§å­
  };
};
```

## ä¸ aardio ç‰ˆæœ¬çš„å¯¹æ¯”

| åŠŸèƒ½ | aardio å®ç° | React å®ç° |
|------|------------|-----------|
| é€‰ä¸­éšæœºç§å­ | API æ”¶åˆ° randomSeed å¸ƒå°”å€¼ | âœ… useEffect ç«‹å³ç”Ÿæˆéšæœºæ•° |
| ç§å­ä¼ é€’æ–¹å¼ | ä¼ é€’å›ºå®šå€¼ + randomSeed æ ‡å¿— | âœ… ä¼ é€’ seed å€¼ï¼ˆå·²éšæœºåŒ–ï¼‰ |
| ç”Ÿæˆåæ›´æ–° | ä½¿ç”¨ API è¿”å›çš„ç§å­æ›´æ–° UI | âœ… ä½¿ç”¨å®é™…ç§å­æ›´æ–° UI |
| å–æ¶ˆéšæœºç§å­ | ä¿ç•™å½“å‰å€¼ | âœ… useEffect ä¸è§¦å‘ï¼Œä¿ç•™å€¼ |
| è¾“å…¥æ¡†çŠ¶æ€ | éšæœºæ—¶ä»å¯ç¼–è¾‘ | âœ… éšæœºæ—¶ disabled |

### å…³é”®å·®å¼‚

| æ–¹é¢ | aardio | React ç‰ˆæœ¬ |
|------|---------|-----------|
| **éšæœºæ€§å¤„ç†ä½ç½®** | API å±‚é¢ï¼ˆrandomSeed æ ‡å¿—ï¼‰ | UI å±‚é¢ï¼ˆuseEffect ç”Ÿæˆï¼‰ |
| **ç§å­è¿”å›æœºåˆ¶** | Gradio API è¿”å› result[2] | ModelScope API ä¸è¿”å›ï¼ˆå›é€€åˆ°ä¼ å…¥å€¼ï¼‰ |
| **éšæœºç§å­æ ‡è¯†** | å¸ƒå°”å€¼ `randomSeed` | é€šè¿‡ useEffect æ£€æµ‹ |

## ç”¨æˆ·ä½“éªŒæµç¨‹

### åœºæ™¯ 1ï¼šé€‰ä¸­éšæœºç§å­

```
åˆå§‹ï¼šç§å­ = 42
  â†“
ç‚¹å‡»"éšæœºç§å­"æŒ‰é’®
  â†“
isRandomSeed: true
  â†“
useEffect è§¦å‘ï¼šç”Ÿæˆéšæœºç§å­ 578392 âœ…
  â†“
ç§å­è¾“å…¥æ¡†æ˜¾ç¤º: 578392 âœ…
ï¼ˆè¾“å…¥æ¡†å˜ä¸º disabledï¼‰
  â†“
ç‚¹å‡»"ç”Ÿæˆè®¾è®¡å›¾"
  â†“
API æ”¶åˆ° seed = 578392
  â†“
ç”Ÿæˆä¸­... (ä½¿ç”¨ 578392)
  â†“
ç”Ÿæˆå®Œæˆ
  â†“
generationState.seed = 578392
  â†“
setSeedInput("578392") âœ…
ï¼ˆUI æ˜¾ç¤ºå®é™…ä½¿ç”¨çš„ç§å­ï¼‰
```

### åœºæ™¯ 2ï¼šå¤šæ¬¡ç‚¹å‡»éšæœºç§å­

```
ç§å­ = 42
  â†“
ç‚¹å‡»"éšæœºç§å­"æŒ‰é’®
  â†“
useEffect è§¦å‘ â†’ ç§å­æ˜¾ç¤º: 123456
  â†“
å†æ¬¡ç‚¹å‡»"éšæœºç§å­"æŒ‰é’®
  â†“
useEffect è§¦å‘ â†’ ç§å­æ›´æ–°ä¸º: 789012 âœ…
ï¼ˆisRandomSeed ä¿æŒä¸º trueï¼Œä½† useEffect ä¼šå†æ¬¡è§¦å‘ï¼‰
  â†“
ç¬¬ä¸‰æ¬¡ç‚¹å‡»"éšæœºç§å­"æŒ‰é’®
  â†“
useEffect è§¦å‘ â†’ ç§å­æ›´æ–°ä¸º: 345678 âœ…
```

### åœºæ™¯ 3ï¼šå–æ¶ˆéšæœºç§å­

```
ç‚¹å‡»"éšæœºç§å­"æŒ‰é’®
  â†“
useEffect è§¦å‘ â†’ ç§å­æ˜¾ç¤º: 578392
  â†“
ç‚¹å‡»"éšæœºç§å­"æŒ‰é’®ï¼ˆå–æ¶ˆéšæœºï¼‰
  â†“
isRandomSeed: false
  â†“
useEffect ä¸è§¦å‘ âœ…
  â†“
ç§å­ä»ç„¶æ˜¾ç¤º: 578392 âœ…ï¼ˆä¿ç•™å½“å‰å€¼ï¼‰
ï¼ˆè¾“å…¥æ¡†å˜ä¸ºå¯ç¼–è¾‘ï¼‰
  â†“
å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æˆ–ä¿æŒä¸å˜
```

### åœºæ™¯ 4ï¼šç”Ÿæˆå›¾åƒ

```
ä½¿ç”¨éšæœºç§å­ç”Ÿæˆ
  â†“
ç”Ÿæˆä¸­... (ä½¿ç”¨ 123456)
  â†“
ç”Ÿæˆå®Œæˆ
  â†“
setSeedInput("123456") âœ…ï¼ˆæ›´æ–°ä¸ºå®é™…ä½¿ç”¨çš„ç§å­ï¼‰
```

## æŠ€æœ¯ä¼˜åŠ¿

### 1. ä¸ aardio ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ

- âœ… å³æ—¶åé¦ˆï¼šç‚¹å‡»éšæœºæŒ‰é’®åç«‹å³çœ‹åˆ°éšæœºç§å­
- âœ… ç²¾ç¡®æ˜¾ç¤ºï¼šç”Ÿæˆåæ˜¾ç¤ºå®é™…ä½¿ç”¨çš„ç§å­
- âœ… å¯è¿½æº¯æ€§ï¼šå¯ä»¥å¤åˆ¶ç§å­å€¼ç”¨äºå…¶ä»–åœ°æ–¹
- âœ… å¯é‡å¤æ€§ï¼šå¯ä»¥ä½¿ç”¨ç›¸åŒç§å­å¤ç°å›¾åƒ

### 2. æ›´å¥½çš„å®ç°

- âœ… UI å±‚é¢ç”Ÿæˆéšæœºæ•°ï¼šæ›´å¿«ï¼Œç”¨æˆ·ç«‹å³çœ‹åˆ°ç»“æœ
- âœ… API å±‚é¢å¤„ç†éšæœºæ€§ï¼šå¦‚æœ API æ”¯æŒ randomSeed æ ‡å¿—ï¼Œå¯ä»¥æ— ç¼åˆ‡æ¢
- âœ… ç±»å‹å®‰å…¨ï¼šè¿”å›å¯¹è±¡åŒ…å« imageUrl å’Œ seed
- âœ… å›é€€æœºåˆ¶ï¼šå¦‚æœ API ä¸è¿”å›ç§å­ï¼Œä½¿ç”¨ä¼ å…¥çš„å€¼

### 3. çµæ´»æ€§

- âœ… å¯ä»¥è¿ç»­å¤šæ¬¡ç‚¹å‡»è·å–ä¸åŒçš„éšæœºæ•°
- âœ… å¯ä»¥å–æ¶ˆéšæœºåä½¿ç”¨ä¸Šæ¬¡çš„éšæœºç§å­
- âœ… ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ç§å­å€¼

## ä»£ç å˜æ›´æ€»ç»“

### App.tsx

#### å˜æ›´ 1ï¼šæ·»åŠ  useEffectï¼ˆç¬¬ 97-103 è¡Œï¼‰

```typescript
// Generate random seed when random mode is enabled
useEffect(() => {
  if (isRandomSeed) {
    const randomSeed = Math.floor(Math.random() * 1000000);
    setSeedInput(randomSeed.toString());
  }
}, [isRandomSeed]);
```

#### å˜æ›´ 2ï¼šç®€åŒ–ç”Ÿæˆé€»è¾‘ï¼ˆç¬¬ 179 è¡Œï¼‰

**ä¿®å¤å‰**ï¼š
```typescript
const usedSeed = isRandomSeed ? Math.floor(Math.random() * 1000000) : parseInt(seedInput) || 42;
if (isRandomSeed) setSeedInput(usedSeed.toString());
```

**ä¿®å¤å**ï¼š
```typescript
const usedSeed = parseInt(seedInput) || 42;
```

#### å˜æ›´ 3ï¼šç”Ÿæˆåæ›´æ–° UIï¼ˆç¬¬ 207-220 è¡Œï¼‰

**ä¿®å¤å‰**ï¼š
```typescript
const imageUrl = await generateImage(prompt, resolution, usedSeed, config, controller.signal);

setGenerationState({
  isGenerating: false,
  progress: 100,
  imageUrl: imageUrl,
  seed: usedSeed
});

setSeedInput(usedSeed.toString());
```

**ä¿®å¤å**ï¼š
```typescript
const result = await generateImage(prompt, resolution, usedSeed, config, controller.signal);

const actualSeed = result.seed || usedSeed;

setGenerationState({
  isGenerating: false,
  progress: 100,
  imageUrl: result.imageUrl,
  seed: actualSeed
});

setSeedInput(actualSeed.toString());
```

### services/generationService.ts

#### å˜æ›´ 1ï¼šä¿®æ”¹è¿”å›ç±»å‹ï¼ˆç¬¬ 63 è¡Œï¼‰

**ä¿®å¤å‰**ï¼š
```typescript
): Promise<string> => {
```

**ä¿®å¤å**ï¼š
```typescript
): Promise<{ imageUrl: string; seed: number | null }> => {
```

#### å˜æ›´ 2ï¼šè¿”å›å¯¹è±¡ï¼ˆç¬¬ 171-173 è¡Œï¼‰

**ä¿®å¤å‰**ï¼š
```typescript
return taskData.output_images[0];
```

**ä¿®å¤å**ï¼š
```typescript
return {
  imageUrl: taskData.output_images[0],
  seed: null // ModelScope API ç›®å‰ä¸è¿”å›ç§å­
};
```

## æµ‹è¯•éªŒè¯

### âœ… åŸºæœ¬åŠŸèƒ½æµ‹è¯•

1. **å³æ—¶æ˜¾ç¤º**
   - ç‚¹å‡»"éšæœºç§å­" â†’ è¾“å…¥æ¡†ç«‹å³æ˜¾ç¤ºéšæœºæ•°
   - é¢„æœŸï¼šè¾“å…¥æ¡†æ˜¾ç¤ºæ–°çš„éšæœºç§å­ï¼ˆå¦‚ 578392ï¼‰

2. **å¤šæ¬¡éšæœº**
   - è¿ç»­ç‚¹å‡»"éšæœºç§å­" 3 æ¬¡
   - é¢„æœŸï¼šæ¯æ¬¡éƒ½æ˜¾ç¤ºä¸åŒçš„éšæœºæ•°

3. **å–æ¶ˆä¿ç•™**
   - ç‚¹å‡»éšæœº â†’ ç”Ÿæˆ â†’ å–æ¶ˆéšæœº
   - é¢„æœŸï¼šç§å­å€¼ä¿æŒä¸å˜

4. **ç”Ÿæˆä½¿ç”¨**
   - ä½¿ç”¨éšæœºç§å­ç”Ÿæˆå›¾åƒ
   - é¢„æœŸï¼šç”Ÿæˆåç§å­å€¼ä¸å˜

### âœ… è¾¹ç•Œæƒ…å†µæµ‹è¯•

5. **ç©ºå€¼å¤„ç†**
   - æ¸…ç©ºç§å­è¾“å…¥æ¡† â†’ ç‚¹å‡»"ç”Ÿæˆè®¾è®¡å›¾"
   - é¢„æœŸï¼šä½¿ç”¨é»˜è®¤å€¼ 42

6. **éæ•°å­—è¾“å…¥**
   - è¾“å…¥ "abc" â†’ ç‚¹å‡»"ç”Ÿæˆè®¾è®¡å›¾"
   - é¢„æœŸï¼šä½¿ç”¨é»˜è®¤å€¼ 42

7. **è¶…å‡ºèŒƒå›´**
   - è¾“å…¥ "999999999" â†’ ç‚¹å‡»"ç”Ÿæˆè®¾è®¡å›¾"
   - é¢„æœŸï¼šæ­£å¸¸ä½¿ç”¨ï¼ˆAPI ä¼šå¤„ç†ï¼‰

8. **å°æ•°è¾“å…¥**
   - è¾“å…¥ "42.5" â†’ ç‚¹å‡»"ç”Ÿæˆè®¾è®¡å›¾"
   - é¢„æœŸï¼šä½¿ç”¨ 42ï¼ˆparseInt ä¼šèˆå»å°æ•°ï¼‰

## API å…¼å®¹æ€§è¯´æ˜

### Gradio API (aardio)

- **å‚æ•°**ï¼š`randomSeed`ï¼ˆå¸ƒå°”å€¼ï¼‰
- **è¿”å›**ï¼š`result[2]`ï¼ˆå®é™…ä½¿ç”¨çš„ç§å­ï¼‰
- **ç‰¹ç‚¹**ï¼šAPI å†…éƒ¨å¤„ç†éšæœºæ€§

### ModelScope API (å½“å‰)

- **å‚æ•°**ï¼š`seed`ï¼ˆæ•´æ•°å€¼ï¼‰
- **è¿”å›**ï¼šä¸è¿”å›ç§å­
- **ç‰¹ç‚¹**ï¼šä½¿ç”¨ä¼ å…¥çš„ç§å­å€¼ï¼ˆå¯ä»¥æ˜¯å›ºå®šçš„æˆ–éšæœºçš„ï¼‰

### å®ç°ç­–ç•¥

- **å½“å‰å®ç°**ï¼šUI å±‚é¢ç”Ÿæˆéšæœºç§å­ï¼Œä¼ é€’ç»™ API
- **å…¼å®¹æ€§**ï¼šåŒæ—¶æ”¯æŒä¸¤ç§ API æ¨¡å¼
- **æœªæ¥æ‰©å±•**ï¼šå¦‚æœ ModelScope API è¿”å›ç§å­ï¼Œå¯ä»¥æ— ç¼ä½¿ç”¨

## éƒ¨ç½²

ä¿®å¤å·²ç»æ„å»ºå®Œæˆï¼Œå¯ä»¥éƒ¨ç½²ï¼š

```bash
npm run build
# ç„¶åä½¿ç”¨ä½ å–œæ¬¢çš„éƒ¨ç½²æ–¹å¼
```

æˆ–è€…ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼š

Windows:
```bash
deploy.bat
```

Mac/Linux:
```bash
./deploy.sh
```

---

## æ€»ç»“

å‚è€ƒ aardio å®ç°åï¼Œéšæœºç§å­åŠŸèƒ½ç°åœ¨å…·å¤‡ï¼š

1. âœ… **å³æ—¶åé¦ˆ**ï¼šç‚¹å‡»éšæœºæŒ‰é’®åç«‹å³æ˜¾ç¤ºéšæœºæ•°
2. âœ… **ç²¾ç¡®æ˜¾ç¤º**ï¼šç”Ÿæˆåæ˜¾ç¤ºå®é™…ä½¿ç”¨çš„ç§å­
3. âœ… **å¯é‡å¤æ€§**ï¼šå¯ä»¥å¤åˆ¶ç§å­å€¼å¤ç°å›¾åƒ
4. âœ… **çµæ´»æ€§**ï¼šå¯ä»¥å¤šæ¬¡ç‚¹å‡»è·å–ä¸åŒéšæœºæ•°
5. âœ… **å¯è¿½æº¯æ€§**ï¼šå–æ¶ˆéšæœºåä¿ç•™ä¸Šæ¬¡çš„ç§å­
6. âœ… **ä¸ aardio ä¸€è‡´**ï¼šç”¨æˆ·ä½“éªŒæ¨¡å¼ç›¸åŒ
7. âœ… **API å…¼å®¹**ï¼šæ”¯æŒ Gradio å’Œ ModelScope ä¸¤ç§ API

ç”¨æˆ·ä½“éªŒæ›´åŠ æµç•…å’Œç›´è§‚ï¼ğŸ‰
